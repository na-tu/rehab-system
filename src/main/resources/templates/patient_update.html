<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>患者編集フォーム</title>
</head>
<body>
<h1>患者登録編集</h1>
<!-- 成功メッセージ -->
<p th:if="${message}" th:text="${message}" style="color: green; font-weight: bold;"></p>
<!-- 患者編集フォーム -->
<form th:action="${patient.id} != null ? @{/patients/{id}/update(id=${patient.id})} : @{/patients/register}"
      th:object="${patient}" method="post">
  <div th:replace="~{fragments/patientForm :: patientFormFragment}"></div>
  <button type="submit">更新</button>
</form>

<!-- リハビリ記録 追加フォーム -->
<h3>リハビリ記録 追加</h3>
<form th:action="@{/patients/{id}/rehabRecord/add(id=${patient.id})}"
      th:object="${rehabRecord}" method="post">
  <input type="hidden" th:field="*{id}" />
  <input type="hidden" th:field="*{patientId}" />
  <input type="date" th:field="*{date}" />
  <input type="text" th:field="*{content}" />
  <button type="submit">追加</button>
</form>

<!-- リハビリ記録 編集フォーム -->
<h3>これまでのリハビリ記録</h3>
<table border="1">
  <tr>
    <th>実施日</th>
    <th>リハビリ内容・評価</th>
    <th>操作</th>
  </tr>
  <tr th:each="record : ${rehabRecords}">
    <td>
      <form th:action="@{/patients/{id}/rehabRecord/update(id=${patient.id})}" method="post">
        <input type="hidden" name="id" th:value="${record.id}" />
        <input type="hidden" name="patientId" th:value="${record.patientId}" />
        <input type="date" name="date" th:value="${record.date}" />
    <td>
      <input type="text" name="content" th:value="${record.content}" />
    </td>

    <td>
      <button type="submit">更新</button>
      </form>
      <!-- ★削除ボタン -->
      <form th:action="@{'/patients/' + ${patient.id} + '/rehabRecord/' + ${record.id} + '/delete'}" method="post" style="display:inline;">
        <button type="submit" onclick="return confirm('本当に削除しますか？')">削除</button>
      </form>
    </td>
  </tr>
</table>
<form th:action="@{/patients/list}" method="get">
  <button type="submit">患者一覧へ戻る</button>
</form>
<!-- 患者詳細ページへ戻るボタン -->
<form th:action="@{'/patients/' + ${patient.id}}" method="get" style="display:inline;">
  <button type="submit">患者詳細ページに戻る</button>
</form>

</body>
</html>
